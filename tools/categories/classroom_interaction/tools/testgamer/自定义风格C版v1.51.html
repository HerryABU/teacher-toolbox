<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ç»å…¸æ¸¸æˆç­”é¢˜å†’é™©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Helvetica Neue", "Arial", sans-serif;
            height: 100vh;
            overflow: hidden;
            position: relative;
            transition: background 0.8s ease;
        }

        #gameContainer {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 15px;
            left: 15px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 2px 2px 3px rgba(0,0,0,0.6);
            z-index: 100;
        }

        #hud div {
            margin-bottom: 5px;
        }

        /* éŸ³æ•ˆå¼€å…³ */
        #soundToggle {
            position: absolute;
            top: 15px;
            right: 15px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            z-index: 100;
            text-shadow: 2px 2px 3px rgba(0,0,0,0.6);
        }

        /* é¢˜ç›®åŒºåŸŸ */
        #questionArea {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            text-align: center;
            font-size: 18px;
            line-height: 1.6;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            z-index: 20;
            transition: all 0.5s ease;
        }

        /* æ§åˆ¶æŒ‰é’® */
        #controls {
            position: absolute;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .controlBtn {
            width: 70px;
            height: 70px;
            background: rgba(255,255,255,0.3);
            border: 3px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }

        .controlBtn:active {
            background: rgba(255,255,255,0.5);
            transform: scale(0.95);
        }

        /* ä¸‹ä¸€é¢˜æŒ‰é’® */
        #nextBtn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 40px;
            background: #00A800;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 100;
            display: none;
        }

        #nextBtn:hover {
            background: #00C800;
            transform: scale(1.05);
        }

        /* ç­”æ¡ˆåé¦ˆé¢æ¿ */
        #answerFeedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 200;
            display: none;
            max-width: 80%;
        }

        #answerFeedback h3 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        #answerFeedback p {
            font-size: 18px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* åé¦ˆæŒ‰é’® */
        .feedbackBtn {
            padding: 12px 30px;
            margin: 0 10px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .continueBtn {
            background: #00A800;
            color: white;
        }

        .continueBtn:hover {
            background: #00C800;
        }

        .retryBtn {
            background: #FF6B35;
            color: white;
        }

        .retryBtn:hover {
            background: #FF8552;
        }

        /* å¼€å§‹ç•Œé¢ */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 300;
            color: white;
        }

        #startScreen h1 {
            font-size: 28px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
        }

        .startBtn {
            padding: 15px 40px;
            background: #FF6B35;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .startBtn:hover {
            background: #FF8552;
            transform: scale(1.05);
        }

        /* ç»“æŸç•Œé¢ */
        .endScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 400;
            color: white;
        }

        .endScreen h1 {
            font-size: 32px;
            margin-bottom: 20px;
        }

        .endScreen .stats {
            font-size: 20px;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.6;
        }

        /* é€šç”¨åŠ¨ç”» */
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-150px) scale(0.3); opacity: 0; }
        }

        /* é»„é‡‘çŸ¿å·¥ç‰¹æœ‰åŠ¨ç”» */
        @keyframes swing {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(20deg); }
            100% { transform: rotate(0deg); }
        }

        /* æ˜Ÿé™…å°„å‡»ç‰¹æœ‰åŠ¨ç”» */
        @keyframes flyLeft {
            0% { transform: translateX(100vw); }
            100% { transform: translateX(-100px); }
        }

        /* é©¬é‡Œå¥¥ç‰¹æœ‰åŠ¨ç”» */
        @keyframes bump {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* å“åº”å¼ */
        @media (max-width: 600px) {
            #questionArea { font-size: 16px; padding: 15px; }
            .controlBtn { width: 60px; height: 60px; font-size: 24px; }
            #nextBtn { padding: 12px 30px; font-size: 16px; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- æ¸¸æˆå¯¹è±¡å®¹å™¨ -->
        <div id="gameObjects"></div>

        <!-- HUD -->
        <div id="hud">
            <div>åˆ†æ•°: <span id="score">0</span></div>
            <div>æ”¶é›†: <span id="rewards">0</span></div>
            <div>ç”Ÿå‘½: <span id="lives">â¤ï¸â¤ï¸â¤ï¸</span></div>
        </div>

        <!-- éŸ³æ•ˆå¼€å…³ -->
        <div id="soundToggle">ğŸ”Š éŸ³æ•ˆ: å¼€</div>

        <!-- é¢˜ç›®åŒº -->
        <div id="questionArea">
            <div id="questionText">ç‚¹å‡»å¼€å§‹æ¸¸æˆ</div>
        </div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div id="controls">
            <div class="controlBtn" id="leftBtn">â†</div>
            <div class="controlBtn" id="actionBtn">â†‘</div>
            <div class="controlBtn" id="rightBtn">â†’</div>
        </div>

        <!-- ä¸‹ä¸€é¢˜æŒ‰é’® -->
        <button id="nextBtn">ä¸‹ä¸€é¢˜</button>

        <!-- ç­”æ¡ˆåé¦ˆé¢æ¿ -->
        <div id="answerFeedback">
            <h3 id="feedbackTitle">ç­”æ¡ˆåé¦ˆ</h3>
            <p id="feedbackMessage">è¿™é‡Œæ˜¯åé¦ˆä¿¡æ¯</p>
            <div>
                <button class="feedbackBtn continueBtn" id="continueBtn">ç»§ç»­</button>
                <button class="feedbackBtn retryBtn" id="retryBtn">é‡è¯•æœ¬é¢˜</button>
            </div>
        </div>

        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="startScreen">
            <h1>ğŸ® ç»å…¸æ¸¸æˆç­”é¢˜å†’é™© ğŸ•¹ï¸</h1>
            <p style="color:#ccc;margin-bottom:30px;">æ¯ä¸ªä¸»é¢˜éƒ½æ˜¯åŸç‰ˆæ¸¸æˆç©æ³•ï¼</p>
            <button class="startBtn" id="startBtn">å¼€å§‹å†’é™©</button>
        </div>
    </div>

    <script>
        // =====================
        // ğŸ”Š éŸ³æ•ˆç³»ç»Ÿ
        // =====================
        const soundEnabled = {
            enabled: true,
            toggle: function() {
                this.enabled = !this.enabled;
                document.getElementById('soundToggle').textContent = `ğŸ”Š éŸ³æ•ˆ: ${this.enabled ? 'å¼€' : 'å…³'}`;
            },
            play: function(audio) {
                if (!this.enabled || !audio) return;
                // åˆ›å»ºæ–°çš„éŸ³é¢‘å®ä¾‹ï¼Œé¿å…é‡å 
                const sound = audio.cloneNode();
                sound.volume = 0.5;
                sound.play().catch(e => console.log("Audio play failed:", e));
            }
        };

        // é¢„åŠ è½½éŸ³æ•ˆ
        const sounds = {
            // é©¬é‡Œå¥¥éŸ³æ•ˆ
            marioJump: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Jump.wav'),
            marioCoin: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Ring.wav'),
            marioBump: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Bump.wav'),
            
            // æ˜Ÿé™…å°„å‡»éŸ³æ•ˆ
            shoot: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Shoot.wav'),
            explosion: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Explosion.wav'),
            hit: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Hit.wav'),
            
            // é»„é‡‘çŸ¿å·¥éŸ³æ•ˆ
            throwHook: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Spring.wav'),
            grab: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/PowerUp.wav'),
            retract: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Jump.wav'),
            
            // é€šç”¨éŸ³æ•ˆ
            correct: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/1-Up.wav'),
            wrong: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/LoseLife.wav'),
            next: new Audio('https://cdn.jsdelivr.net/gh/ajayyy/Sonic-1-Genesis-Sound-Effects@master/Menu.wav')
        };

        // =====================
        // ğŸ® ä¸»é¢˜æ¸¸æˆç³»ç»Ÿï¼ˆå¸¦éŸ³æ•ˆï¼‰
        // =====================
        const themes = {
            mario: {
                name: "è¶…çº§é©¬é‡Œå¥¥",
                background: "linear-gradient(to bottom, #5C94FC 0%, #5C94FC 80%, #C84C0C 80%)",
                init: function() {
                    this.createScene();
                },
                createScene: function() {
                    const gameObjects = document.getElementById('gameObjects');
                    gameObjects.innerHTML = '';
                    
                    // åˆ›å»ºåœ°é¢
                    const ground = document.createElement('div');
                    ground.style.cssText = "position:absolute;bottom:0;width:100%;height:100px;background:linear-gradient(to bottom, #8B7355 0%, #8B7355 10%, #5C4033 10%);border-top:5px solid #3A2A1A;";
                    gameObjects.appendChild(ground);

                    // åˆ›å»ºé©¬é‡Œå¥¥
                    const mario = document.createElement('div');
                    mario.id = 'mario';
                    mario.style.cssText = `
                        position: absolute;
                        bottom: 100px;
                        left: 150px;
                        width: 40px;
                        height: 40px;
                        z-index: 10;
                        transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                    `;
                    mario.innerHTML = `
                        <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="20" cy="15" r="12" fill="#FF6B35"/>
                            <rect x="10" y="20" width="20" height="15" fill="red" rx="2"/>
                            <rect x="12" y="35" width="6" height="5" fill="#333" rx="1"/>
                            <rect x="22" y="35" width="6" height="5" fill="#333" rx="1"/>
                            <circle cx="16" cy="12" r="2" fill="#fff"/>
                            <circle cx="24" cy="12" r="2" fill="#fff"/>
                            <circle cx="17" cy="12" r="1" fill="#000"/>
                            <circle cx="25" cy="12" r="1" fill="#000"/>
                            <rect x="18" y="18" width="4" height="2" fill="#000" rx="1"/>
                        </svg>
                    `;
                    gameObjects.appendChild(mario);

                    // åˆ›å»ºç®¡é“
                    const pipe1 = document.createElement('div');
                    pipe1.style.cssText = "position:absolute;width:80px;height:120px;bottom:100px;left:400px;background:linear-gradient(to right,#00A800,#00D800,#008400);border:3px solid #003600;border-radius:5px 5px 0 0;";
                    pipe1.innerHTML = "<div style='position:absolute;top:-25px;left:-15px;width:110px;height:50px;background:inherit;border:3px solid #003600;border-radius:5px;'></div>";
                    gameObjects.appendChild(pipe1);

                    // åˆ›å»ºé—®å·ç –å—å’Œæ™®é€šç –å—
                    const blocksContainer = document.createElement('div');
                    blocksContainer.className = 'blocksContainer';
                    blocksContainer.style.cssText = "position:absolute;top:220px;left:200px;display:flex;gap:10px;z-index:15;";
                    gameObjects.appendChild(blocksContainer);

                    // åˆ›å»º4ä¸ªç –å—ï¼ˆæ··åˆé—®å·å—å’Œæ™®é€šå—ï¼‰
                    for(let i = 0; i < 4; i++) {
                        const block = document.createElement('div');
                        block.className = 'optionBlock';
                        block.dataset.index = i;
                        block.style.cssText = `
                            width: 50px;
                            height: 50px;
                            background: ${i % 2 === 0 ? 'linear-gradient(to bottom, #FFB84D, #CC8E33)' : 'linear-gradient(to bottom, #D4AF37, #B8860B)'};
                            border: 2px solid #663300;
                            border-radius: 3px;
                            display: flex;
                            flex-direction: column;
                            justify-content: center;
                            align-items: center;
                            font-family: "Helvetica Neue", Arial, sans-serif;
                            color: #333;
                            cursor: default;
                            position: relative;
                        `;
                        if (i % 2 === 0) {
                            block.innerHTML = `
                                <div class="label" style="font-size:18px;font-weight:bold;">?</div>
                                <div class="hiddenText" style="font-size:10px;margin-top:2px;visibility:hidden;">${String.fromCharCode(65 + i)}</div>
                            `;
                        } else {
                            block.innerHTML = `
                                <div class="label" style="font-size:18px;font-weight:bold;">${String.fromCharCode(65 + i)}</div>
                                <div class="text" style="font-size:10px;margin-top:2px;"></div>
                            `;
                        }
                        blocksContainer.appendChild(block);
                    }

                    // åˆ›å»ºäº‘æœµ
                    const cloud1 = document.createElement('div');
                    cloud1.style.cssText = "position:absolute;width:100px;height:40px;top:80px;left:300px;background:white;border-radius:50px;opacity:0.8;";
                    cloud1.innerHTML = "<div style='position:absolute;width:50px;height:50px;top:-25px;left:10px;background:white;border-radius:50px;'></div>";
                    gameObjects.appendChild(cloud1);

                    const cloud2 = document.createElement('div');
                    cloud2.style.cssText = "position:absolute;width:80px;height:35px;top:60px;right:200px;background:white;border-radius:50px;opacity:0.8;";
                    cloud2.innerHTML = "<div style='position:absolute;width:60px;height:40px;top:-20px;right:15px;background:white;border-radius:50px;'></div>";
                    gameObjects.appendChild(cloud2);
                },
                updateBlocks: function(options) {
                    const blocks = document.querySelectorAll('.optionBlock');
                    blocks.forEach((block, i) => {
                        if (i % 2 === 1) { // æ™®é€šå—æ˜¾ç¤ºæ–‡å­—
                            block.querySelector('.text').textContent = options[i];
                        } else { // é—®å·å—éšè—æ–‡å­—
                            block.querySelector('.hiddenText').textContent = options[i];
                        }
                    });
                },
                move: function(direction) {
                    const mario = document.getElementById('mario');
                    let currentLeft = parseInt(mario.style.left) || 150;
                    
                    if (direction === 'left') {
                        currentLeft = Math.max(100, currentLeft - 60);
                    } else if (direction === 'right') {
                        currentLeft = Math.min(window.innerWidth - 140, currentLeft + 60);
                    }
                    
                    mario.style.left = currentLeft + 'px';
                    
                    // è®¡ç®—å½“å‰åœ¨å“ªä¸ªç –å—ä¸‹æ–¹
                    const blocks = document.querySelectorAll('.optionBlock');
                    const marioRect = mario.getBoundingClientRect();
                    const marioCenterX = marioRect.left + marioRect.width/2;
                    
                    for(let i = 0; i < blocks.length; i++) {
                        const blockRect = blocks[i].getBoundingClientRect();
                        if (marioCenterX >= blockRect.left && marioCenterX <= blockRect.right) {
                            return i;
                        }
                    }
                    
                    return 0;
                },
                action: function() {
                    const mario = document.getElementById('mario');
                    mario.classList.add('jump');
                    soundEnabled.play(sounds.marioJump); // æ’­æ”¾è·³è·ƒéŸ³æ•ˆ
                    
                    setTimeout(() => {
                        mario.classList.remove('jump');
                    }, 800);
                    
                    // è·³è·ƒæ—¶æ£€æµ‹ç¢°æ’
                    setTimeout(() => {
                        const currentIndex = this.getCurrentBlockIndex();
                        const event = new CustomEvent('optionSelected', {detail: {index: currentIndex}});
                        document.dispatchEvent(event);
                    }, 400);
                    
                    return -1;
                },
                getCurrentBlockIndex: function() {
                    const mario = document.getElementById('mario');
                    const blocks = document.querySelectorAll('.optionBlock');
                    const marioRect = mario.getBoundingClientRect();
                    const marioCenterX = marioRect.left + marioRect.width/2;
                    
                    for(let i = 0; i < blocks.length; i++) {
                        const blockRect = blocks[i].getBoundingClientRect();
                        if (marioCenterX >= blockRect.left && marioCenterX <= blockRect.right) {
                            return i;
                        }
                    }
                    
                    return 0;
                },
                animateCorrect: function(index) {
                    const blocks = document.querySelectorAll('.optionBlock');
                    if (blocks[index]) {
                        blocks[index].style.animation = "bump 0.6s ease-out";
                        // æ˜¾ç¤ºéšè—çš„æ–‡å­—
                        const hiddenText = blocks[index].querySelector('.hiddenText');
                        if (hiddenText) {
                            hiddenText.style.visibility = "visible";
                            hiddenText.style.color = "#00A800";
                            hiddenText.style.fontWeight = "bold";
                        }
                        soundEnabled.play(sounds.marioCoin); // æ’­æ”¾é‡‘å¸éŸ³æ•ˆ
                    }
                },
                animateWrong: function(index) {
                    const blocks = document.querySelectorAll('.optionBlock');
                    if (blocks[index]) {
                        blocks[index].style.animation = "bump 0.6s ease-out";
                        blocks[index].style.opacity = "0.5";
                        // æ˜¾ç¤ºéšè—çš„æ–‡å­—
                        const hiddenText = blocks[index].querySelector('.hiddenText');
                        if (hiddenText) {
                            hiddenText.style.visibility = "visible";
                            hiddenText.style.color = "#FF0000";
                            hiddenText.style.fontWeight = "bold";
                        }
                        soundEnabled.play(sounds.marioBump); // æ’­æ”¾ç¢°æ’éŸ³æ•ˆ
                    }
                },
                spawnReward: function(x, y) {
                    const reward = document.createElement('div');
                    reward.className = 'reward';
                    reward.style.cssText = `
                        position: absolute;
                        left: ${x}px;
                        top: ${y}px;
                        width: 30px;
                        height: 30px;
                        background: radial-gradient(circle, #FFD700, #FFA500);
                        border: 2px solid #FFB84D;
                        border-radius: 50%;
                        z-index: 50;
                        animation: floatUp 1.5s ease-out forwards;
                    `;
                    document.getElementById('gameContainer').appendChild(reward);
                    
                    setTimeout(() => {
                        reward.remove();
                    }, 1500);
                }
            },

            space: {
                name: "æ˜Ÿé™…å°„å‡»",
                background: "linear-gradient(to bottom, #000033 0%, #000066 100%)",
                bullets: [],
                enemies: [],
                init: function() {
                    this.createScene();
                },
                createScene: function() {
                    const gameObjects = document.getElementById('gameObjects');
                    gameObjects.innerHTML = '';
                    
                    // åˆ›å»ºåœ°é¢ï¼ˆå¤ªç©ºåº•éƒ¨ï¼‰
                    const ground = document.createElement('div');
                    ground.style.cssText = "position:absolute;bottom:0;width:100%;height:80px;background:linear-gradient(to bottom, #4B0082 0%, #2E0854 100%);border-top:5px solid #000;";
                    gameObjects.appendChild(ground);

                    // åˆ›å»ºé£èˆ¹ï¼ˆå·¦ä¸‹è§’ï¼‰
                    const ship = document.createElement('div');
                    ship.id = 'ship';
                    ship.style.cssText = `
                        position: absolute;
                        bottom: 100px;
                        left: 100px;
                        width: 60px;
                        height: 40px;
                        z-index: 10;
                        transition: left 0.2s ease;
                    `;
                    ship.innerHTML = `
                        <svg viewBox="0 0 60 40" xmlns="http://www.w3.org/2000/svg">
                            <path d="M30,5 L10,25 L20,25 L20,35 L40,35 L40,25 L50,25 Z" fill="#C0C0C0" stroke="#696969" stroke-width="2"/>
                            <circle cx="30" cy="15" r="3" fill="#FF4500"/>
                            <rect x="27" y="35" width="6" height="3" fill="#FF4500"/>
                            <polygon points="15,25 5,30 15,35" fill="#FF6347"/>
                            <polygon points="45,25 55,30 45,35" fill="#FF6347"/>
                        </svg>
                    `;
                    gameObjects.appendChild(ship);

                    // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
                    for(let i = 0; i < 150; i++) {
                        const star = document.createElement('div');
                        star.style.cssText = `
                            position: absolute;
                            width: ${Math.random() * 2 + 1}px;
                            height: ${Math.random() * 2 + 1}px;
                            top: ${Math.random() * 100}%;
                            left: ${Math.random() * 100}%;
                            background: white;
                            border-radius: 50%;
                            box-shadow: 0 0 ${Math.random() * 3 + 1}px white;
                            animation: twinkle ${Math.random() * 3 + 2}s infinite;
                        `;
                        gameObjects.appendChild(star);
                    }

                    // åˆ›å»ºè¡Œæ˜Ÿï¼ˆè¿œå¤„ï¼‰
                    const planet = document.createElement('div');
                    planet.style.cssText = `
                        position: absolute;
                        width: 120px;
                        height: 120px;
                        top: 150px;
                        right: 100px;
                        background: radial-gradient(circle, #FF6347, #8B0000);
                        border-radius: 50%;
                        box-shadow: 0 0 30px #FF6347;
                        animation: rotate 40s linear infinite;
                    `;
                    gameObjects.appendChild(planet);

                    // åˆ›å»ºæ•Œäººï¼ˆä»å³å‘å·¦é£è¡Œçš„é€‰é¡¹ï¼‰
                    const enemyContainer = document.createElement('div');
                    enemyContainer.className = 'enemyContainer';
                    enemyContainer.style.cssText = "position:absolute;top:180px;right:0;width:100%;height:200px;overflow:hidden;z-index:5;";
                    gameObjects.appendChild(enemyContainer);

                    // åˆ›å»º4ä¸ªæ•Œäºº
                    const options = ["A", "B", "C", "D"]; // ä¸´æ—¶å ä½
                    for(let i = 0; i < 4; i++) {
                        const enemy = document.createElement('div');
                        enemy.className = 'spaceEnemy';
                        enemy.dataset.index = i;
                        enemy.style.cssText = `
                            position: absolute;
                            width: 60px;
                            height: 60px;
                            background: radial-gradient(circle, #4682B4, #000080);
                            border: 2px solid #0000CD;
                            border-radius: 50%;
                            display: flex;
                            flex-direction: column;
                            justify-content: center;
                            align-items: center;
                            font-family: "Helvetica Neue", Arial, sans-serif;
                            color: white;
                            cursor: default;
                            top: ${100 + i * 70}px;
                            right: -100px;
                            box-shadow: 0 0 15px rgba(70,130,180,0.5);
                            animation: flyLeft ${8 + i * 2}s linear infinite;
                            animation-delay: ${i * 1}s;
                        `;
                        enemy.innerHTML = `
                            <div class="label" style="font-size:20px;font-weight:bold;">${options[i]}</div>
                            <div class="text" style="font-size:10px;margin-top:2px;text-align:center;"></div>
                        `;
                        enemyContainer.appendChild(enemy);
                        this.enemies.push(enemy);
                    }
                },
                updateEnemies: function(options) {
                    const enemyElements = document.querySelectorAll('.spaceEnemy');
                    enemyElements.forEach((enemy, i) => {
                        enemy.querySelector('.text').textContent = options[i];
                    });
                },
                move: function(direction) {
                    const ship = document.getElementById('ship');
                    let currentLeft = parseInt(ship.style.left) || 100;
                    
                    if (direction === 'left') {
                        currentLeft = Math.max(50, currentLeft - 20);
                    } else if (direction === 'right') {
                        currentLeft = Math.min(window.innerWidth - 160, currentLeft + 20);
                    }
                    
                    ship.style.left = currentLeft + 'px';
                    return this.getCurrentTargetIndex();
                },
                action: function() {
                    const ship = document.getElementById('ship');
                    const shipRect = ship.getBoundingClientRect();
                    
                    // åˆ›å»ºå­å¼¹
                    const bullet = document.createElement('div');
                    bullet.className = 'bullet';
                    bullet.style.cssText = `
                        position: absolute;
                        left: ${shipRect.left + shipRect.width - 5}px;
                        top: ${shipRect.top + 15}px;
                        width: 8px;
                        height: 4px;
                        background: #FF4500;
                        border-radius: 2px;
                        z-index: 20;
                        box-shadow: 0 0 10px #FF4500;
                    `;
                    document.getElementById('gameContainer').appendChild(bullet);
                    
                    soundEnabled.play(sounds.shoot); // æ’­æ”¾å°„å‡»éŸ³æ•ˆ
                    
                    // åŠ¨ç”»å­å¼¹
                    let bulletLeft = shipRect.left + shipRect.width - 5;
                    const bulletInterval = setInterval(() => {
                        bulletLeft += 15;
                        bullet.style.left = `${bulletLeft}px`;
                        
                        if (bulletLeft > window.innerWidth) {
                            clearInterval(bulletInterval);
                            bullet.remove();
                        }
                        
                        // æ£€æµ‹ç¢°æ’
                        const enemies = document.querySelectorAll('.spaceEnemy');
                        enemies.forEach((enemy, index) => {
                            const enemyRect = enemy.getBoundingClientRect();
                            if (bulletLeft > enemyRect.left && 
                                bulletLeft < enemyRect.right + 20 &&
                                parseFloat(bullet.style.top) > enemyRect.top &&
                                parseFloat(bullet.style.top) < enemyRect.bottom) {
                                
                                clearInterval(bulletInterval);
                                bullet.remove();
                                this.onEnemyHit(index);
                            }
                        });
                    }, 16);
                    
                    this.bullets.push({element: bullet, interval: bulletInterval});
                    return -1;
                },
                onEnemyHit: function(index) {
                    soundEnabled.play(sounds.hit); // æ’­æ”¾å‘½ä¸­éŸ³æ•ˆ
                    const event = new CustomEvent('optionSelected', {detail: {index: index}});
                    document.dispatchEvent(event);
                },
                getCurrentTargetIndex: function() {
                    const ship = document.getElementById('ship');
                    const shipRect = ship.getBoundingClientRect();
                    const enemies = document.querySelectorAll('.spaceEnemy');
                    
                    let closestIndex = 0;
                    let closestDistance = Infinity;
                    
                    enemies.forEach((enemy, index) => {
                        const enemyRect = enemy.getBoundingClientRect();
                        const distance = Math.abs(enemyRect.left - (shipRect.left + shipRect.width));
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closestIndex = index;
                        }
                    });
                    
                    return closestIndex;
                },
                animateCorrect: function(index) {
                    const enemies = document.querySelectorAll('.spaceEnemy');
                    if (enemies[index]) {
                        enemies[index].style.animation = "explode 0.6s ease-out forwards";
                        enemies[index].style.transform = "scale(1.5) rotate(360deg)";
                        enemies[index].style.boxShadow = "0 0 30px #00FF00";
                        soundEnabled.play(sounds.correct); // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
                    }
                },
                animateWrong: function(index) {
                    const enemies = document.querySelectorAll('.spaceEnemy');
                    if (enemies[index]) {
                        enemies[index].style.animation = "explode 0.6s ease-out forwards";
                        enemies[index].style.transform = "scale(0.5) rotate(180deg)";
                        enemies[index].style.opacity = "0.3";
                        enemies[index].style.boxShadow = "0 0 30px #FF0000";
                        soundEnabled.play(sounds.wrong); // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                    }
                },
                spawnReward: function(x, y) {
                    const reward = document.createElement('div');
                    reward.className = 'reward';
                    reward.style.cssText = `
                        position: absolute;
                        left: ${x}px;
                        top: ${y}px;
                        width: 25px;
                        height: 25px;
                        background: radial-gradient(circle, #00BFFF, #0000CD);
                        border: 2px solid #00008B;
                        border-radius: 50%;
                        box-shadow: 0 0 20px #00BFFF;
                        z-index: 50;
                        animation: floatUp 1.5s ease-out forwards;
                    `;
                    document.getElementById('gameContainer').appendChild(reward);
                    
                    setTimeout(() => {
                        reward.remove();
                    }, 1500);
                }
            },

            goldMiner: {
                name: "é»„é‡‘çŸ¿å·¥",
                background: "linear-gradient(to bottom, #8B4513 0%, #A0522D 30%, #654321 100%)",
                hook: null,
                hookChain: null,
                hookActive: false,
                grabbedOption: null,
                grabbedOptionIndex: null,
                init: function() {
                    this.createScene();
                },
                createScene: function() {
                    const gameObjects = document.getElementById('gameObjects');
                    gameObjects.innerHTML = '';
                    
                    // åˆ›å»ºåœ°é¢
                    const ground = document.createElement('div');
                    ground.style.cssText = "position:absolute;bottom:0;width:100%;height:100px;background:linear-gradient(to bottom, #5C4033 0%, #2F1C0F 100%);border-top:5px solid #000;";
                    gameObjects.appendChild(ground);

                    // åˆ›å»ºçŸ¿å·¥ï¼ˆåœ¨å·¦ä¸Šè§’ï¼‰
                    const miner = document.createElement('div');
                    miner.id = 'miner';
                    miner.style.cssText = `
                        position: absolute;
                        top: 80px;
                        left: 100px;
                        width: 50px;
                        height: 50px;
                        z-index: 20;
                    `;
                    miner.innerHTML = `
                        <svg viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="25" cy="15" r="12" fill="#8B4513"/>
                            <rect x="15" y="20" width="20" height="18" fill="#A0522D" rx="2"/>
                            <rect x="17" y="38" width="6" height="5" fill="#000"/>
                            <rect x="27" y="38" width="6" height="5" fill="#000"/>
                            <circle cx="20" cy="12" r="2" fill="#fff"/>
                            <circle cx="30" cy="12" r="2" fill="#fff"/>
                            <circle cx="21" cy="12" r="1" fill="#000"/>
                            <circle cx="31" cy="12" r="1" fill="#000"/>
                            <path d="M22 18 Q25 20 28 18" stroke="#000" stroke-width="1" fill="none"/>
                            <rect x="23" y="8" width="4" height="3" fill="#FFD700"/>
                        </svg>
                    `;
                    gameObjects.appendChild(miner);

                    // åˆ›å»ºçŸ¿æ´èƒŒæ™¯
                    const caveWallLeft = document.createElement('div');
                    caveWallLeft.style.cssText = "position:absolute;top:0;left:0;width:150px;bottom:0;background:linear-gradient(to right,#5C4033,#8B4513);";
                    gameObjects.appendChild(caveWallLeft);

                    const caveWallRight = document.createElement('div');
                    caveWallRight.style.cssText = "position:absolute;top:0;right:0;width:150px;bottom:0;background:linear-gradient(to left,#5C4033,#8B4513);";
                    gameObjects.appendChild(caveWallRight);

                    // åˆ›å»ºå²©çŸ³ï¼ˆä½¿ç”¨ä¸åŒå½¢çŠ¶å’Œå¤§å°ï¼‰
                    const rock1 = document.createElement('div');
                    rock1.style.cssText = "position:absolute;width:120px;height:80px;bottom:350px;left:200px;background:#696969;border-radius:20px 10px 30px 15px;transform:rotate(5deg);box-shadow:8px 8px 20px rgba(0,0,0,0.5);";
                    gameObjects.appendChild(rock1);

                    const rock2 = document.createElement('div');
                    rock2.style.cssText = "position:absolute;width:90px;height:110px;bottom:280px;right:220px;background:#5D5D5D;border-radius:15px 25px 10px 30px;transform:rotate(-8deg);box-shadow:8px 8px 20px rgba(0,0,0,0.5);";
                    gameObjects.appendChild(rock2);

                    const rock3 = document.createElement('div');
                    rock3.style.cssText = "position:absolute;width:70px;height:60px;bottom:420px;left:400px;background:#7A7A7A;border-radius:25px 15px 20px 10px;transform:rotate(12deg);box-shadow:8px 8px 20px rgba(0,0,0,0.5);";
                    gameObjects.appendChild(rock3);

                    // åˆ›å»ºçŸ¿è½¦è½¨é“
                    const rail = document.createElement('div');
                    rail.style.cssText = "position:absolute;bottom:120px;left:0;width:100%;height:15px;background:#3A2A1A;border-top:3px solid #000;border-bottom:3px solid #000;";
                    gameObjects.appendChild(rail);

                    // åˆ›å»ºçŸ¿è½¦ï¼ˆåœ¨è½¨é“ä¸Šï¼‰
                    const cart = document.createElement('div');
                    cart.style.cssText = "position:absolute;width:100px;height:50px;bottom:135px;left:30%;background:#8B4513;border:3px solid #000;border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,0.5);animation:moveCart 8s linear infinite;";
                    cart.innerHTML = `
                        <div style="position:absolute;bottom:-12px;left:25px;width:20px;height:12px;background:#000;border-radius:50%;"></div>
                        <div style="position:absolute;bottom:-12px;right:25px;width:20px;height:12px;background:#000;border-radius:50%;"></div>
                        <div style="position:absolute;top:5px;left:5px;right:5px;height:20px;background:#A0522D;border-radius:5px;"></div>
                    `;
                    gameObjects.appendChild(cart);

                    // åˆ›å»ºé‡‘å—ï¼ˆé€‰é¡¹ï¼‰ - åˆ†å¸ƒåœ¨åœ°åº•ä¸åŒä½ç½®
                    const goldContainer = document.createElement('div');
                    goldContainer.className = 'goldContainer';
                    goldContainer.style.cssText = "position:absolute;top:0;left:0;width:100%;height:100%;z-index:5;";
                    gameObjects.appendChild(goldContainer);

                    // ä¸åŒä½ç½®çš„é‡‘å—
                    const positions = [
                        {left: '25%', top: '65%', size: 70},
                        {right: '30%', top: '75%', size: 80},
                        {left: '55%', top: '85%', size: 75},
                        {right: '35%', top: '60%', size: 85}
                    ];

                    for(let i = 0; i < 4; i++) {
                        const gold = document.createElement('div');
                        gold.className = 'minerGold';
                        gold.dataset.index = i;
                        gold.style.cssText = `
                            position: absolute;
                            width: ${positions[i].size}px;
                            height: ${positions[i].size}px;
                            background: radial-gradient(circle at 30% 30%, #FFD700, #DAA520);
                            border: 4px solid #B8860B;
                            border-radius: 50%;
                            display: flex;
                            flex-direction: column;
                            justify-content: center;
                            align-items: center;
                            font-family: "Helvetica Neue", Arial, sans-serif;
                            color: #5C4033;
                            font-weight: bold;
                            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
                            box-shadow: 5px 5px 20px rgba(218,165,32,0.5);
                            ${positions[i].left ? `left: ${positions[i].left};` : `right: ${positions[i].right};`}
                            top: ${positions[i].top};
                        `;
                        gold.innerHTML = `
                            <div class="label" style="font-size:24px;">${String.fromCharCode(65 + i)}</div>
                            <div class="text" style="font-size:12px;margin-top:5px;text-align:center;"></div>
                        `;
                        goldContainer.appendChild(gold);
                    }
                },
                updateGolds: function(options) {
                    const goldElements = document.querySelectorAll('.minerGold');
                    goldElements.forEach((gold, i) => {
                        gold.querySelector('.text').textContent = options[i];
                    });
                },
                move: function(direction) {
                    // é»„é‡‘çŸ¿å·¥ä¸éœ€è¦ç§»åŠ¨ï¼Œé’©å­ä»å›ºå®šä½ç½®æŠ›å‡º
                    return 0;
                },
                action: function() {
                    if (this.hookActive) return -1;
                    
                    const miner = document.getElementById('miner');
                    const minerRect = miner.getBoundingClientRect();
                    
                    // åˆ›å»ºé’©å­é“¾æ¡
                    this.hookChain = document.createElement('div');
                    this.hookChain.style.cssText = `
                        position: absolute;
                        left: ${minerRect.right - 5}px;
                        top: ${minerRect.bottom - 10}px;
                        width: 2px;
                        height: 0;
                        background: #696969;
                        z-index: 15;
                    `;
                    document.getElementById('gameContainer').appendChild(this.hookChain);
                    
                    // åˆ›å»ºé’©å­
                    this.hook = document.createElement('div');
                    this.hook.className = 'hook';
                    this.hook.style.cssText = `
                        position: absolute;
                        left: ${minerRect.right - 10}px;
                        top: ${minerRect.bottom - 5}px;
                        width: 12px;
                        height: 12px;
                        background: #696969;
                        clip-path: path('M0,0 L12,0 L12,12 L6,6 L0,12 Z');
                        z-index: 16;
                        box-shadow: 0 0 5px rgba(0,0,0,0.5);
                    `;
                    document.getElementById('gameContainer').appendChild(this.hook);
                    
                    soundEnabled.play(sounds.throwHook); // æ’­æ”¾æŠ›é’©éŸ³æ•ˆ
                    
                    // é’©å­ç‰©ç†å‚æ•°
                    let hookX = minerRect.right - 10;
                    let hookY = minerRect.bottom - 5;
                    let velocityX = 6; // åˆå§‹å‘å³é€Ÿåº¦
                    let velocityY = 8; // åˆå§‹å‘ä¸‹é€Ÿåº¦
                    let gravity = 0.4;
                    let maxChainLength = 500;
                    let currentChainLength = 0;
                    let swinging = false;
                    
                    this.hookActive = true;
                    
                    const hookInterval = setInterval(() => {
                        if (!swinging) {
                            // æŠ›å°„é˜¶æ®µ
                            velocityY += gravity;
                            hookX += velocityX;
                            hookY += velocityY;
                            currentChainLength = Math.sqrt((hookX - (minerRect.right - 10))**2 + (hookY - (minerRect.bottom - 5))**2);
                            
                            this.hookChain.style.height = `${currentChainLength}px`;
                            this.hookChain.style.transform = `rotate(${Math.atan2(velocityY, velocityX)}rad)`;
                            this.hookChain.style.transformOrigin = 'top center';
                            this.hook.style.left = `${hookX}px`;
                            this.hook.style.top = `${hookY}px`;
                            
                            if (currentChainLength >= maxChainLength || hookY > window.innerHeight - 150) {
                                swinging = true;
                                velocityX = 2; // å‡é€Ÿå¹¶å¼€å§‹æ‘†åŠ¨
                            }
                        } else {
                            // æ‘†åŠ¨é˜¶æ®µ
                            hookX += velocityX;
                            hookY += 0.5; // ç¼“æ…¢ä¸‹é™
                            
                            this.hook.style.left = `${hookX}px`;
                            this.hook.style.top = `${hookY}px`;
                            this.hookChain.style.height = `${Math.sqrt((hookX - (minerRect.right - 10))**2 + (hookY - (minerRect.bottom - 5))**2)}px`;
                            this.hookChain.style.transform = `rotate(${Math.atan2(hookY - (minerRect.bottom - 5), hookX - (minerRect.right - 10))}rad)`;
                            
                            // æ£€æµ‹ç¢°æ’
                            const golds = document.querySelectorAll('.minerGold');
                            golds.forEach((gold, index) => {
                                const goldRect = gold.getBoundingClientRect();
                                const hookRect = this.hook.getBoundingClientRect();
                                
                                if (!this.grabbedOption && 
                                    hookRect.right > goldRect.left + 20 &&
                                    hookRect.left < goldRect.right - 20 &&
                                    hookRect.bottom > goldRect.top + 20 &&
                                    hookRect.top < goldRect.bottom - 20) {
                                    
                                    // æŠ“å–é‡‘å—
                                    this.grabbedOption = gold;
                                    this.grabbedOptionIndex = index;
                                    this.grabbedOption.style.transition = "none";
                                    this.grabbedOption.style.zIndex = "25";
                                    soundEnabled.play(sounds.grab); // æ’­æ”¾æŠ“å–éŸ³æ•ˆ
                                }
                            });
                            
                            // å¦‚æœæŠ“å–äº†é‡‘å—ï¼Œå¼€å§‹å›æ”¶
                            if (this.grabbedOption) {
                                clearInterval(hookInterval);
                                this.retractHook();
                                return;
                            }
                        }
                        
                        // è¾¹ç•Œæ£€æµ‹
                        if (hookX < 50) velocityX = Math.abs(velocityX);
                        if (hookX > window.innerWidth - 50) velocityX = -Math.abs(velocityX);
                        if (hookY > window.innerHeight - 100) velocityY = -Math.abs(velocityY) * 0.8;
                        
                    }, 30);
                    
                    return -1;
                },
                retractHook: function() {
                    soundEnabled.play(sounds.retract); // æ’­æ”¾å›æ”¶éŸ³æ•ˆ
                    
                    const miner = document.getElementById('miner');
                    const minerRect = miner.getBoundingClientRect();
                    const targetX = minerRect.right - 10;
                    const targetY = minerRect.bottom - 5;
                    
                    let currentX = parseFloat(this.hook.style.left);
                    let currentY = parseFloat(this.hook.style.top);
                    let currentChainLength = Math.sqrt((currentX - targetX)**2 + (currentY - targetY)**2);
                    
                    const retractInterval = setInterval(() => {
                        // è®¡ç®—æ–¹å‘
                        const dx = targetX - currentX;
                        const dy = targetY - currentY;
                        const distance = Math.sqrt(dx*dx + dy*dy);
                        
                        if (distance < 5) {
                            // åˆ°è¾¾é¡¶éƒ¨
                            clearInterval(retractInterval);
                            this.hook.remove();
                            this.hookChain.remove();
                            this.hook = null;
                            this.hookChain = null;
                            this.hookActive = false;
                            
                            // è§¦å‘é€‰é¡¹é€‰æ‹©
                            const event = new CustomEvent('optionSelected', {detail: {index: this.grabbedOptionIndex}});
                            document.dispatchEvent(event);
                            
                            this.grabbedOption = null;
                            this.grabbedOptionIndex = null;
                        } else {
                            // ç§»åŠ¨é’©å­å’ŒæŠ“å–çš„é‡‘å—
                            currentX += dx * 0.08;
                            currentY += dy * 0.08;
                            
                            this.hook.style.left = `${currentX}px`;
                            this.hook.style.top = `${currentY}px`;
                            this.hookChain.style.height = `${Math.sqrt((currentX - targetX)**2 + (currentY - targetY)**2)}px`;
                            this.hookChain.style.transform = `rotate(${Math.atan2(currentY - targetY, currentX - targetX)}rad)`;
                            
                            // ç§»åŠ¨æŠ“å–çš„é‡‘å—
                            if (this.grabbedOption) {
                                this.grabbedOption.style.left = `${currentX - this.grabbedOption.offsetWidth/2 + 6}px`;
                                this.grabbedOption.style.top = `${currentY - this.grabbedOption.offsetHeight/2 + 6}px`;
                            }
                        }
                    }, 30);
                },
                getCurrentTargetIndex: function() {
                    return 0;
                },
                animateCorrect: function(index) {
                    const golds = document.querySelectorAll('.minerGold');
                    if (golds[index]) {
                        golds[index].style.animation = "bounce 0.6s ease-out";
                        golds[index].style.boxShadow = "0 0 30px #00FF00";
                        soundEnabled.play(sounds.correct); // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
                    }
                },
                animateWrong: function(index) {
                    const golds = document.querySelectorAll('.minerGold');
                    if (golds[index]) {
                        golds[index].style.animation = "shake 0.6s ease-out";
                        golds[index].style.opacity = "0.5";
                        golds[index].style.boxShadow = "0 0 30px #FF0000";
                        soundEnabled.play(sounds.wrong); // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                    }
                },
                spawnReward: function(x, y) {
                    const reward = document.createElement('div');
                    reward.className = 'reward';
                    reward.style.cssText = `
                        position: absolute;
                        left: ${x}px;
                        top: ${y}px;
                        width: 40px;
                        height: 40px;
                        background: radial-gradient(circle, #FFD700, #B8860B);
                        border: 4px solid #DAA520;
                        border-radius: 50%;
                        box-shadow: 0 0 30px rgba(255,215,0,0.8);
                        z-index: 50;
                        animation: floatUp 1.5s ease-out forwards;
                    `;
                    document.getElementById('gameContainer').appendChild(reward);
                    
                    setTimeout(() => {
                        reward.remove();
                    }, 1500);
                }
            }
        };

        // =====================
        // ğŸ“š é¢˜ç›®æ•°æ®
        // =====================
        const questions = [
            {
                question: "JavaScriptä¸­ï¼Œä»¥ä¸‹å“ªä¸ªä¸æ˜¯åŸå§‹æ•°æ®ç±»å‹ï¼Ÿ",
                options: ["Number", "Array", "String", "Boolean"],
                correct: "B",
                theme: "mario"
            },
            {
                question: "HTML5ä¸­ï¼Œå“ªä¸ªæ ‡ç­¾ç”¨äºå®šä¹‰å¯¼èˆªé“¾æ¥ï¼Ÿ",
                options: ["nav", "navigation", "navigate", "menu"],
                correct: "A",
                theme: "space"
            },
            {
                question: "CSSä¸­ï¼Œå“ªä¸ªå±æ€§ç”¨äºè®¾ç½®å…ƒç´ çš„é€æ˜åº¦ï¼Ÿ",
                options: ["transparency", "opacity", "visible", "alpha"],
                correct: "B",
                theme: "goldMiner"
            },
            {
                question: "åœ¨Gitä¸­ï¼Œå“ªä¸ªå‘½ä»¤ç”¨äºæŸ¥çœ‹æäº¤å†å²ï¼Ÿ",
                options: ["git status", "git log", "git history", "git show"],
                correct: "B",
                theme: "space"
            },
            {
                question: "Reactä¸­ï¼Œå“ªä¸ªHookç”¨äºå¤„ç†å‰¯ä½œç”¨ï¼Ÿ",
                options: ["useState", "useReducer", "useEffect", "useContext"],
                correct: "C",
                theme: "goldMiner"
            },
            {
                question: "HTTPçŠ¶æ€ç 404è¡¨ç¤ºä»€ä¹ˆï¼Ÿ",
                options: ["æœåŠ¡å™¨é”™è¯¯", "æœªæ‰¾åˆ°", "ç¦æ­¢è®¿é—®", "è¯·æ±‚è¶…æ—¶"],
                correct: "B",
                theme: "mario"
            },
            {
                question: "Pythonä¸­ï¼Œå“ªä¸ªå…³é”®å­—ç”¨äºå®šä¹‰å‡½æ•°ï¼Ÿ",
                options: ["function", "def", "func", "define"],
                correct: "B",
                theme: "goldMiner"
            },
            {
                question: "æ•°æ®åº“ä¸­ï¼ŒSQLçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿ",
                options: ["Structured Query Language", "Simple Query Language", "Standard Query Language", "System Query Language"],
                correct: "A",
                theme: "space"
            }
        ];

        // =====================
        // ğŸ® æ¸¸æˆçŠ¶æ€
        // =====================
        let gameState = {
            score: 0,
            rewards: 0,
            lives: 3,
            currentQuestion: 0,
            gameStarted: false,
            currentTheme: null,
            currentThemeObj: null,
            awaitingNext: false,
            currentAnswer: null
        };

        // DOM å…ƒç´ 
        const questionArea = document.getElementById('questionArea');
        const questionText = document.getElementById('questionText');
        const scoreElement = document.getElementById('score');
        const rewardsElement = document.getElementById('rewards');
        const livesElement = document.getElementById('lives');
        const startScreen = document.getElementById('startScreen');
        const startBtn = document.getElementById('startBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        const actionBtn = document.getElementById('actionBtn');
        const nextBtn = document.getElementById('nextBtn');
        const answerFeedback = document.getElementById('answerFeedback');
        const feedbackTitle = document.getElementById('feedbackTitle');
        const feedbackMessage = document.getElementById('feedbackMessage');
        const continueBtn = document.getElementById('continueBtn');
        const retryBtn = document.getElementById('retryBtn');
        const soundToggle = document.getElementById('soundToggle');

        // =====================
        // ğŸ¨ ä¸»é¢˜åº”ç”¨å‡½æ•°
        // =====================
        function applyTheme(themeKey) {
            const theme = themes[themeKey];
            if (!theme) return;

            // åº”ç”¨èƒŒæ™¯
            document.body.style.background = theme.background;
            
            // åˆå§‹åŒ–ä¸»é¢˜åœºæ™¯
            theme.init();
            
            gameState.currentTheme = themeKey;
            gameState.currentThemeObj = theme;
        }

        // =====================
        // ğŸ® æ¸¸æˆé€»è¾‘
        // =====================
        function initGame() {
            startScreen.style.display = 'none';
            gameState = {
                score: 0,
                rewards: 0,
                lives: 3,
                currentQuestion: 0,
                gameStarted: true,
                currentTheme: null,
                currentThemeObj: null,
                awaitingNext: false,
                currentAnswer: null
            };
            updateHUD();
            loadQuestion();
        }

        function loadQuestion() {
            if (gameState.currentQuestion >= questions.length) {
                endGame(true);
                return;
            }

            const q = questions[gameState.currentQuestion];
            
            // åº”ç”¨ä¸»é¢˜
            if (q.theme) {
                applyTheme(q.theme);
            }

            // æ˜¾ç¤ºé¢˜ç›®
            questionText.textContent = q.question;

            // æ›´æ–°é€‰é¡¹å†…å®¹
            if (gameState.currentThemeObj) {
                if (gameState.currentTheme === 'mario') {
                    gameState.currentThemeObj.updateBlocks(q.options);
                } else if (gameState.currentTheme === 'space') {
                    gameState.currentThemeObj.updateEnemies(q.options);
                } else if (gameState.currentTheme === 'goldMiner') {
                    gameState.currentThemeObj.updateGolds(q.options);
                }
            }
            
            // é‡ç½®çŠ¶æ€
            gameState.awaitingNext = false;
            nextBtn.style.display = 'none';
            answerFeedback.style.display = 'none';
        }

        function move(direction) {
            if (!gameState.gameStarted || !gameState.currentThemeObj || gameState.awaitingNext) return -1;
            
            return gameState.currentThemeObj.move(direction);
        }

        function action() {
            if (!gameState.gameStarted || !gameState.currentThemeObj || gameState.awaitingNext) return -1;
            
            return gameState.currentThemeObj.action();
        }

        function checkAnswer(selectedIndex) {
            if (gameState.awaitingNext) return;
            
            const currentQ = questions[gameState.currentQuestion];
            const selectedOption = String.fromCharCode(65 + selectedIndex);
            gameState.currentAnswer = {index: selectedIndex, option: selectedOption};

            if (selectedOption === currentQ.correct) {
                // æ­£ç¡®
                gameState.currentThemeObj.animateCorrect(selectedIndex);
                gameState.score += 100;
                gameState.rewards += 1;
                updateHUD();

                // ç”Ÿæˆå¥–åŠ±
                setTimeout(() => {
                    const elements = document.querySelectorAll(
                        gameState.currentTheme === 'mario' ? '.optionBlock' : 
                        gameState.currentTheme === 'space' ? '.spaceEnemy' : '.minerGold'
                    );
                    if (elements[selectedIndex]) {
                        const rect = elements[selectedIndex].getBoundingClientRect();
                        gameState.currentThemeObj.spawnReward(rect.left + rect.width/2, rect.top);
                    }
                }, 100);

                // æ˜¾ç¤ºåé¦ˆ
                showAnswerFeedback(true, `âœ“ å›ç­”æ­£ç¡®ï¼`, `æ­£ç¡®ç­”æ¡ˆæ˜¯ ${selectedOption}: ${currentQ.options[selectedIndex]}`);
                soundEnabled.play(sounds.correct); // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
            } else {
                // é”™è¯¯
                gameState.currentThemeObj.animateWrong(selectedIndex);
                gameState.lives -= 1;
                updateHUD();

                // æ˜¾ç¤ºåé¦ˆ
                showAnswerFeedback(false, `âœ— å›ç­”é”™è¯¯ï¼`, `æ­£ç¡®ç­”æ¡ˆæ˜¯ ${currentQ.correct}: ${currentQ.options[getCorrectIndex(currentQ)]}\nä½ é€‰æ‹©äº† ${selectedOption}: ${currentQ.options[selectedIndex]}`);
                soundEnabled.play(sounds.wrong); // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                
                if (gameState.lives <= 0) {
                    setTimeout(() => {
                        endGame(false);
                    }, 2000);
                    return;
                }
            }
            
            gameState.awaitingNext = true;
            nextBtn.style.display = 'block';
        }

        function showAnswerFeedback(isCorrect, title, message) {
            feedbackTitle.textContent = title;
            feedbackTitle.style.color = isCorrect ? '#00FF00' : '#FF0000';
            feedbackMessage.innerHTML = message.replace(/\n/g, '<br>');
            answerFeedback.style.display = 'block';
        }

        function getCorrectIndex(q) {
            return q.correct.charCodeAt(0) - 65;
        }

        function nextQuestion() {
            soundEnabled.play(sounds.next); // æ’­æ”¾ä¸‹ä¸€é¢˜éŸ³æ•ˆ
            answerFeedback.style.display = 'none';
            nextBtn.style.display = 'none';
            gameState.currentQuestion++;
            loadQuestion();
        }

        function retryQuestion() {
            soundEnabled.play(sounds.next); // æ’­æ”¾é‡è¯•éŸ³æ•ˆ
            answerFeedback.style.display = 'none';
            nextBtn.style.display = 'none';
            gameState.awaitingNext = false;
            loadQuestion(); // é‡æ–°åŠ è½½å½“å‰é¢˜ç›®
        }

        function updateHUD() {
            scoreElement.textContent = gameState.score;
            rewardsElement.textContent = gameState.rewards;
            livesElement.textContent = 'â¤ï¸'.repeat(gameState.lives);
        }

        function endGame(isWin) {
            gameState.gameStarted = false;

            const endScreen = document.createElement('div');
            endScreen.className = 'endScreen';
            endScreen.innerHTML = `
                <h1>${isWin ? 'ğŸ‰ é€šå…³æˆåŠŸï¼' : 'ğŸ’€ æ¸¸æˆç»“æŸ'}</h1>
                <div class="stats">
                    æœ€ç»ˆå¾—åˆ†: ${gameState.score}<br>
                    æ”¶é›†ç‰©å“: ${gameState.rewards}<br>
                    ${isWin ? 'ä½ æ˜¯çœŸæ­£çš„æ¸¸æˆå¤§å¸ˆï¼' : 'å†æ¥å†å‰ï¼'}
                </div>
                <button class="startBtn" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
            `;
            document.body.appendChild(endScreen);
        }

        // =====================
        // ğŸ–±ï¸ äº‹ä»¶ç»‘å®š
        // =====================
        startBtn.addEventListener('click', initGame);

        leftBtn.addEventListener('click', () => {
            move('left');
        });

        rightBtn.addEventListener('click', () => {
            move('right');
        });

        actionBtn.addEventListener('click', () => {
            const selectedIndex = action();
            if (selectedIndex !== -1) {
                checkAnswer(selectedIndex);
            }
        });

        nextBtn.addEventListener('click', nextQuestion);

        continueBtn.addEventListener('click', nextQuestion);

        retryBtn.addEventListener('click', retryQuestion);

        // éŸ³æ•ˆå¼€å…³
        soundToggle.addEventListener('click', () => {
            soundEnabled.toggle();
        });

        // ç›‘å¬å¼‚æ­¥é€‰æ‹©äº‹ä»¶
        document.addEventListener('optionSelected', (e) => {
            checkAnswer(e.detail.index);
        });

        document.addEventListener('keydown', (e) => {
            if (!gameState.gameStarted) return;

            // éŸ³æ•ˆå¼€å…³
            if (e.key === 'm' || e.key === 'M') {
                soundEnabled.toggle();
                return;
            }

            if (gameState.awaitingNext) {
                if (e.key === 'Enter' || e.key === ' ') {
                    nextQuestion();
                }
                return;
            }

            switch(e.key) {
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    move('left');
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    move('right');
                    break;
                case 'ArrowUp':
                case ' ':
                case 'w':
                case 'W':
                    const selectedIndex = action();
                    if (selectedIndex !== -1) {
                        checkAnswer(selectedIndex);
                    }
                    break;
            }
        });

        // æ·»åŠ ä¸»é¢˜ç‰¹å®šåŠ¨ç”»
        const animations = document.createElement('style');
        animations.textContent = `
            @keyframes twinkle {
                0%, 100% { opacity: 0.3; }
                50% { opacity: 1; }
            }
            
            @keyframes rotate {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            @keyframes flyLeft {
                0% { transform: translateX(100vw); }
                100% { transform: translateX(-100px); }
            }
            
            @keyframes bump {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-20px); }
            }
            
            @keyframes explode {
                0% { transform: scale(1) rotate(0deg); }
                100% { transform: scale(1.5) rotate(360deg); }
            }
            
            @keyframes moveCart {
                0% { left: -150px; }
                100% { left: 110%; }
            }
            
            @keyframes bounce {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.2); }
            }
            
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            
            @keyframes floatUp {
                0% { transform: translateY(0) scale(1); opacity: 1; }
                100% { transform: translateY(-150px) scale(0.3); opacity: 0; }
            }
            
            #mario.jump {
                animation: jump 0.8s ease-out;
            }
            
            @keyframes jump {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-120px); }
            }
        `;
        document.head.appendChild(animations);

        // åˆå§‹åŒ– HUD
        updateHUD();
    </script>
</body>
</html>